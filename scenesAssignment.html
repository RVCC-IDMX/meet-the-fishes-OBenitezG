<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scene Assignment</title>

    <script src="https://pixijs.download/release/pixi.js"></script>
    <script src="js/bezier.js"></script>
    <script src="js/animate.js"></script>
    <script src="js/ui_elements.js"></script>
    <script>
        var app = new PIXI.Application();
    </script>
    <script src="js/director.js"></script>

</head>
<body>
    <script type="module">
    
        //The App
        //var app = new PIXI.Application()
        await app.init({
            width:640,
            height:480,
            backgroundColor: 0x000000
        })
        var stage = app.stage
        var view = app.canvas

        //Image Load
        await PIXI.Assets.load('img/Crab.png')
        await PIXI.Assets.load('img/GoldFish.png')
        await PIXI.Assets.load('img/AnglerFish.png')
    
        //Add view to the document
        document.body.appendChild(app.view)

        //Surface and UI
        let surface = new PIXI.Container()

        let surfaceButton = UI.Button(0,0,"Dive V")
            surfaceButton.x = app.view.width  - surfaceButton.width
            surfaceButton.y = app.view.height - surfaceButton.height

        surface.addChild(surfaceButton)

        let surfaceText = new PIXI.Text("Surface",{fill:0xFFFFFF})

        surface.addChild(surfaceText)

        //Surface Fish and Animation
        let crab = PIXI.Sprite.from('img/Crab.png')
            crab.y = 300

        async function crabloop() {
            await Animate.to(crab, {
                x : 550,
                y : 300,
                easing : Animate.easeInOut,
                duration : 5000
            })
            await Animate.to(crab, {
                x : 0,
                y : 300,
                easing : Animate.easeInOut,
                duration : 5000
            })

            crabloop()

        }

        crabloop()

        app.canvas.addEventListener("mousedown", async(event) => {
            let mouse_pos_x = event.clientX
            let mouse_pos_y = event.clientY

            Animate.stop(crab)

            await Animate.to(crab, {
                x : mouse_pos_x,
                y : mouse_pos_y,
                easing : Animate.easeOut,
                duration : 200
            })

            crabloop()
        })


        surface.addChild(crab)


        app.stage.addChild(surface)

        //Stage 2
        let depths = new PIXI.Container()

        let depthsBackButton = UI.Button(0,0, "Ascend ^")
            depthsBackButton.x = app.view.width - depthsBackButton.width

        depths.addChild(depthsBackButton)

        let depthsForwardButton = UI.Button(0,0,"Dive V")
            depthsForwardButton.x = app.view.width  - depthsForwardButton.width
            depthsForwardButton.y = app.view.height - depthsForwardButton.height

        depths.addChild(depthsForwardButton)

        let depthsText = new PIXI.Text("Depths",{fill:0xFFFFFF})

        depths.addChild(depthsText)

        //Stage 2 Fish
        let clownFish = PIXI.Sprite.from('img/GoldFish.png')
            clownFish.x = 300
            clownFish.y = 200


        depths.addChild(clownFish)

        async function clownFishLoop() {
            let color_change = Math.random() * 0xffffff

            await Animate.to(clownFish, {
                x : 300,
                y : 150,
                easing : Animate.easeInOut,
                duration : 3000
            })

            await Animate.to(clownFish, {
                x : 300,
                y : 250,
                tint : color_change,
                easing : Animate.easeInOut,
                duration : 3000
            })

            clownFishLoop()

        }

        clownFishLoop()

        //app.stage.addChild(depths)

        //Stage 3
        let floor = new PIXI.Container()

        let floorBackButton = UI.Button(0,0, "Ascend ^")
            floorBackButton.x = app.view.width - floorBackButton.width

        floor.addChild(floorBackButton)

        let floorText = new PIXI.Text("Sea Floor",{fill:0xFFFFFF})

        floor.addChild(floorText)

        //Stage 3 Fish
        let anglerFish = PIXI.Sprite.from('img/AnglerFish.png')
            anglerFish.anchor.set(0.5)
            anglerFish.scale.x = 2
            anglerFish.scale.y = 2
            anglerFish.x = app.view.width/2
            anglerFish.y = app.view.height/2
            anglerFish.alpha = 0

        async function anglerFishloop() {
            await Animate.to(anglerFish, {
                scale: {
                    x : 3,
                    y : 3
                },
                alpha: 1,
                duration : 5000
            })
            await Animate.to(anglerFish, {
                duration : 2000
            })
            await Animate.to(anglerFish, {
                scale: {
                    x : 2,
                    y : 2
                },
                alpha: 0,
                duration : 5000
            })
            await Animate.to(anglerFish, {
                alpha: 0,
                duration : 5000
            })

            anglerFishloop()

        }

        anglerFishloop()

        floor.addChild(anglerFish)

        //app.stage.addChild(floor)


        // surfaceButton.onclick = () => {
        //     app.stage.removeChild(surface);
        //     app.stage.addChild(depths);
        // }

        // depthsBackButton.onclick = () => {
        //     app.stage.removeChild(depths);
        //     app.stage.addChild(surface);
        // }

        // depthsForwardButton.onclick = () => {
        //     app.stage.removeChild(depths);
        //     app.stage.addChild(floor);
        // }

        // floorBackButton.onclick = () => {
        //     app.stage.removeChild(floor);
        //     app.stage.addChild(depths);
        // }

        Director.addScene("first",surface);
        Director.addScene("second",depths);
        Director.addScene("third",floor);

        surfaceButton.onclick = () => {
            Director.showScene("second", {
                transition : Director.star
                //transition : Director.swipe,
                //direction : "up"
            });
        }

        depthsBackButton.onclick = () => {
            Director.showScene("first", {
                transition : Director.swipe,
                direction : "down"
            });
        }

        depthsForwardButton.onclick = () => {
            Director.showScene("third", {
                transition : Director.swipe,
                direction : "up"
            });
        }

        floorBackButton.onclick = () => {
            Director.showScene("second", {
                transition : Director.swipe,
                direction : "down"
            });
        }

    </script>
    
</body>
</html>